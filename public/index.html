<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Bç«™è§†é¢‘æ”¶è—</title>
</head>
<body>

  <h1>ğŸ¬ æˆ‘çš„Bilibiliè§†é¢‘æ”¶è—ï¼ˆäº‘ç«¯ç‰ˆï¼‰</h1>

  <input id="categoryInput" placeholder="åˆ†ç±»åç§°">
  <input id="videoInput" placeholder="ç²˜è´´Bç«™è§†é¢‘é“¾æ¥" style="width:300px;">
  <button onclick="addVideo()">æ·»åŠ è§†é¢‘</button>

  <hr>

  <div id="videos"></div>

  <script>
    let videos = [];

    async function loadVideos() {
      const res = await fetch("/api/videos");
      videos = await res.json();
      render();
    }

    function render() {
      const container = document.getElementById("videos");
      container.innerHTML = "";

      videos.forEach(video => {
        container.innerHTML += `
          <div>
            <p>åˆ†ç±»: ${video.category}</p>
            <iframe 
              src="https://player.bilibili.com/player.html?bvid=${video.bvid}"
              width="500"
              height="300"
              frameborder="0"
              allowfullscreen>
            </iframe>
            <hr/>
          </div>
        `;
      });
    }

    async function addVideo() {
      const url = document.getElementById("videoInput").value;
      const category = document.getElementById("categoryInput").value || "é»˜è®¤";
      const match = url.match(/BV\w+/);

      if(match){
        await fetch("/api/videos", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            bvid: match[0],
            category: category
          })
        });

        document.getElementById("videoInput").value = "";
        loadVideos();
      } else {
        alert("æ— æ³•è¯†åˆ«BVå·");
      }
    }

    loadVideos();
  </script>

</body>
</html>