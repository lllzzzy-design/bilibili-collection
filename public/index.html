<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Bç«™è§†é¢‘æ”¶è—</title>
</head>
<body>

  <h1>ğŸ¬ æˆ‘çš„Bilibiliè§†é¢‘æ”¶è—</h1>

  <!-- æ·»åŠ æ–°åˆ†ç±» -->
  <input id="newCategoryInput" placeholder="è¾“å…¥æ–°åˆ†ç±»åç§°">
  <button onclick="addCategory()">æ·»åŠ åˆ†ç±»</button>

  <hr>

  <!-- åˆ†ç±»é€‰æ‹© -->
  <select id="categorySelect"></select>

  <input id="videoInput" placeholder="ç²˜è´´Bç«™è§†é¢‘é“¾æ¥" style="width:300px;">
  <button onclick="addVideo()">æ·»åŠ è§†é¢‘</button>

  <hr>

  <!-- åˆ†ç±»ç­›é€‰åŒºåŸŸ -->
  <div id="categoryButtons"></div>

  <hr>

  <!-- è§†é¢‘å±•ç¤ºåŒºåŸŸ -->
  <div id="videos"></div>

  <script>

    let videos = JSON.parse(localStorage.getItem("videos")) || [];
    let categories = JSON.parse(localStorage.getItem("categories")) || ["é»˜è®¤"];
    let currentCategory = "å…¨éƒ¨";

    function save() {
      localStorage.setItem("videos", JSON.stringify(videos));
      localStorage.setItem("categories", JSON.stringify(categories));
    }

    function renderCategories() {
      const select = document.getElementById("categorySelect");
      const buttons = document.getElementById("categoryButtons");

      select.innerHTML = "";
      buttons.innerHTML = "";

      categories.forEach(cat => {
        select.innerHTML += `<option value="${cat}">${cat}</option>`;
        buttons.innerHTML += `<button onclick="setCategory('${cat}')">${cat}</button>`;
      });

      buttons.innerHTML = `<button onclick="setCategory('å…¨éƒ¨')">å…¨éƒ¨</button>` + buttons.innerHTML;
    }

    function renderVideos() {
      const container = document.getElementById("videos");
      container.innerHTML = "";

      videos
        .filter(v => currentCategory === "å…¨éƒ¨" || v.category === currentCategory)
        .forEach(video => {
          container.innerHTML += `
            <div>
              <p>åˆ†ç±»: ${video.category}</p>
              <iframe 
                src="https://player.bilibili.com/player.html?bvid=${video.bvid}"
                width="500"
                height="300"
                frameborder="0"
                allowfullscreen>
              </iframe>
              <hr/>
            </div>
          `;
        });
    }

    function addCategory() {
      const newCat = document.getElementById("newCategoryInput").value.trim();
      if(newCat && !categories.includes(newCat)){
        categories.push(newCat);
        save();
        renderCategories();
        document.getElementById("newCategoryInput").value = "";
      }
    }

    function addVideo() {
      const url = document.getElementById("videoInput").value;
      const category = document.getElementById("categorySelect").value;
      const match = url.match(/BV\w+/);

      if(match){
        videos.push({
          bvid: match[0],
          category: category
        });
        save();
        renderVideos();
        document.getElementById("videoInput").value = "";
      } else {
        alert("æ— æ³•è¯†åˆ«BVå·");
      }
    }

    function setCategory(cat){
      currentCategory = cat;
      renderVideos();
    }

    renderCategories();
    renderVideos();

  </script>

</body>
</html>